<!DOCTYPE html>
<html lang="ko" x-data="{ darkMode: false }" :class="{ 'dark': darkMode }">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>InvestCalendar - ìŠ¤ë§ˆíŠ¸í•œ íˆ¬ì ì¼ì • ê´€ë¦¬</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#eff6ff",
                100: "#dbeafe",
                200: "#bfdbfe",
                300: "#93c5fd",
                400: "#60a5fa",
                500: "#3b82f6",
                600: "#2563eb",
                700: "#1d4ed8",
                800: "#1e40af",
                900: "#1e3a8a",
                950: "#172554",
              },
            },
          },
        },
      };
    </script>

    <!-- Alpine.js -->
    <script
      defer
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <!-- FullCalendar -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />

    <style>
      body {
        font-family: "Inter", "Noto Sans KR", sans-serif;
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }

      ::-webkit-scrollbar-track {
        @apply bg-gray-100 dark:bg-gray-800;
      }

      ::-webkit-scrollbar-thumb {
        @apply bg-gray-300 dark:bg-gray-600 rounded-full;
      }

      ::-webkit-scrollbar-thumb:hover {
        @apply bg-gray-400 dark:bg-gray-500;
      }

      /* Calendar custom styles */
      .fc {
        font-family: "Inter", "Noto Sans KR", sans-serif;
      }

      .dark .fc-theme-standard td,
      .dark .fc-theme-standard th {
        border-color: #374151;
      }

      .dark .fc-theme-standard .fc-scrollgrid {
        border-color: #374151;
      }

      .fc-toolbar-title {
        @apply text-2xl font-bold text-gray-900 dark:text-white;
      }

      .fc-button {
        @apply bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 font-medium px-4 py-2 rounded-lg transition-all hover:bg-gray-50 dark:hover:bg-gray-700;
      }

      .fc-button-active {
        @apply bg-primary-600 text-white border-primary-600 hover:bg-primary-700;
      }

      .fc-event {
        @apply border-0 px-2 py-1 text-xs font-medium cursor-pointer transition-all rounded;
      }

      .fc-event:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
      }

      /* Event type colors */
      .event-earnings {
        @apply bg-green-500 text-white;
      }
      .event-dividend {
        @apply bg-amber-500 text-white;
      }
      .event-disclosure {
        @apply bg-blue-500 text-white;
      }
      .event-holiday {
        @apply bg-red-500 text-white;
      }
      .event-ipo {
        @apply bg-purple-500 text-white;
      }
      .event-meeting {
        @apply bg-pink-500 text-white;
      }
      .event-economic {
        @apply bg-teal-500 text-white;
      }
      .event-personal {
        @apply bg-gray-500 text-white;
      }

      /* AI Loading Animation */
      @keyframes aiThinking {
        0%, 80%, 100% { 
          opacity: 0.3; 
        }
        40% { 
          opacity: 1; 
        }
      }
      
      .ai-loading-dot {
        animation: aiThinking 1.4s infinite ease-in-out both;
      }
      
      .ai-loading-dot:nth-child(1) { animation-delay: -0.32s; }
      .ai-loading-dot:nth-child(2) { animation-delay: -0.16s; }
      
      @keyframes fadeInScale {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
      
      .fade-in-scale {
        animation: fadeInScale 0.3s ease-out;
      }

      /* Animations */
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideInUp {
        from {
          transform: translateY(20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .slide-in-right {
        animation: slideInRight 0.3s ease-out;
      }

      .slide-in-up {
        animation: slideInUp 0.3s ease-out;
      }

      /* Loading spinner */
      .loading-spinner {
        border: 3px solid rgba(0, 0, 0, 0.1);
        border-left-color: #3b82f6;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Glass morphism effect */
      .glass {
        @apply bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg;
      }

      /* Gradient text */
      .gradient-text {
        @apply bg-gradient-to-r from-primary-600 to-purple-600 bg-clip-text text-transparent;
      }

      /* ëª¨ë˜í•œ ìº˜ë¦°ë” ìŠ¤íƒ€ì¼ */
      .fc {
        @apply font-sans;
      }
      
      .fc-toolbar {
        @apply mb-6 flex-wrap gap-4;
      }
      
      .fc-toolbar-title {
        @apply text-2xl font-bold text-gray-800 dark:text-white;
      }
      
      .fc-button {
        @apply px-4 py-2 rounded-lg font-medium text-sm transition-all duration-200 border-0;
      }
      
      .fc-button-primary {
        @apply bg-primary-100 text-primary-700 hover:bg-primary-200 dark:bg-primary-900/50 dark:text-primary-300 dark:hover:bg-primary-800/50;
      }
      
      .fc-button-active {
        @apply bg-primary-600 text-white shadow-lg hover:bg-primary-700;
      }
      
      .fc-daygrid-day {
        @apply hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors duration-200;
      }
      
      .fc-daygrid-day-number {
        @apply text-gray-700 dark:text-gray-300 font-medium;
      }
      
      .fc-event {
        @apply border-0 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer;
      }
      
      .fc-event-title {
        @apply font-medium text-xs;
      }
      
      .fc-list-event:hover {
        @apply bg-gray-50 dark:bg-gray-800;
      }
    </style>
  </head>
  <body
    class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300"
    x-data="calendarApp()"
    x-init="init()"
    :class="{ 'dark': darkMode }"
  >
    <!-- Navigation -->
    <nav
      class="glass sticky top-0 z-50 border-b border-gray-200 dark:border-gray-700"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex items-center">
            <div class="flex-shrink-0 flex items-center">
              <i class="fas fa-chart-line text-primary-600 text-2xl mr-3"></i>
              <h1 class="text-xl font-bold gradient-text">InvestCalendar</h1>
            </div>
            <div class="hidden sm:ml-8 sm:flex sm:space-x-8">
              <a
                href="#"
                @click="activeTab = 'calendar'"
                :class="activeTab === 'calendar' ? 'border-primary-500 text-primary-600 dark:text-primary-400' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-300 dark:hover:text-white'"
                class="inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors"
              >
                <i class="fas fa-calendar-alt mr-2"></i>
                ìº˜ë¦°ë”
              </a>
              <a
                href="#"
                @click="activeTab = 'market'"
                :class="activeTab === 'market' ? 'border-primary-500 text-primary-600 dark:text-primary-400' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-300 dark:hover:text-white'"
                class="inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors"
              >
                <i class="fas fa-chart-bar mr-2"></i>
                ì‹œì¥í˜„í™©
              </a>
              <a
                href="#"
                @click="activeTab = 'watchlist'"
                :class="activeTab === 'watchlist' ? 'border-primary-500 text-primary-600 dark:text-primary-400' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-300 dark:hover:text-white'"
                class="inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors"
              >
                <i class="fas fa-star mr-2"></i>
                ê´€ì‹¬ì¢…ëª©
              </a>
              <a
                href="#"
                @click="activeTab = 'global'"
                :class="activeTab === 'global' ? 'border-primary-500 text-primary-600 dark:text-primary-400' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-300 dark:hover:text-white'"
                class="inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors"
              >
                <i class="fas fa-globe mr-2"></i>
                ê¸€ë¡œë²Œ
              </a>
              <a
                href="#"
                @click="activeTab = 'disclosures'"
                :class="activeTab === 'disclosures' ? 'border-primary-500 text-primary-600 dark:text-primary-400' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-300 dark:hover:text-white'"
                class="inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors"
              >
                <i class="fas fa-file-alt mr-2"></i>
                ê³µì‹œì •ë³´
              </a>
              <a
                href="#"
                @click="activeTab = 'analysis'"
                :class="activeTab === 'analysis' ? 'border-primary-500 text-primary-600 dark:text-primary-400' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-300 dark:hover:text-white'"
                class="inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors"
              >
                <i class="fas fa-analytics mr-2"></i>
                ë¶„ì„
              </a>
            </div>
          </div>
          <div class="flex items-center space-x-4">
            <!-- Stock Search -->
            <div class="relative hidden md:block">
              <input
                type="text"
                x-model="searchQuery"
                @input="searchStocks()"
                placeholder="ì¢…ëª© ê²€ìƒ‰..."
                class="w-64 px-4 py-2 pr-10 text-sm bg-gray-100 dark:bg-gray-800 border-0 rounded-lg focus:ring-2 focus:ring-primary-500 dark:text-white"
              />
              <i
                class="fas fa-search absolute right-3 top-2.5 text-gray-400"
              ></i>

              <!-- Search Results -->
              <div
                x-show="searchResults.length > 0"
                x-transition
                class="absolute top-full mt-2 w-full bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden"
              >
                <template
                  x-for="stock in searchResults"
                  :key="stock.stock_code"
                >
                  <a
                    href="#"
                    @click="selectStock(stock)"
                    class="block px-4 py-2 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                  >
                    <div class="flex justify-between">
                      <span
                        class="font-medium text-gray-900 dark:text-white"
                        x-text="stock.stock_name"
                      ></span>
                      <span
                        class="text-sm text-gray-500 dark:text-gray-400"
                        x-text="stock.stock_code"
                      ></span>
                    </div>
                  </a>
                </template>
              </div>
            </div>

            <!-- Dark Mode Toggle -->
            <button
              @click="darkMode = !darkMode"
              class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-white transition-colors"
            >
              <i class="fas" :class="darkMode ? 'fa-sun' : 'fa-moon'"></i>
            </button>

            <!-- Notifications -->
            <button
              class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-white relative transition-colors"
            >
              <i class="fas fa-bell"></i>
              <span
                class="absolute -top-1 -right-1 h-2 w-2 bg-red-500 rounded-full animate-pulse"
              ></span>
            </button>

            <!-- User Menu -->
            <div class="relative" x-data="{ userMenuOpen: false }">
              <button
                @click="userMenuOpen = !userMenuOpen"
                class="flex items-center space-x-2 p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-white transition-colors"
              >
                <img
                  :src="user ? 'https://ui-avatars.com/api/?name=' + user.username : 'https://ui-avatars.com/api/?name=Guest'"
                  class="w-8 h-8 rounded-full"
                />
              </button>

              <div
                x-show="userMenuOpen"
                @click.away="userMenuOpen = false"
                x-transition
                class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden"
              >
                <template x-if="user">
                  <div>
                    <div
                      class="px-4 py-3 border-b border-gray-200 dark:border-gray-700"
                    >
                      <p
                        class="text-sm font-medium text-gray-900 dark:text-white"
                        x-text="user.username"
                      ></p>
                      <p
                        class="text-xs text-gray-500 dark:text-gray-400"
                        x-text="user.email"
                      ></p>
                    </div>
                    <a
                      href="#"
                      class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700"
                    >
                      <i class="fas fa-user-circle mr-2"></i>í”„ë¡œí•„
                    </a>
                    <a
                      href="#"
                      class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700"
                    >
                      <i class="fas fa-cog mr-2"></i>ì„¤ì •
                    </a>
                    <hr class="border-gray-200 dark:border-gray-700" />
                    <button
                      @click="logout()"
                      class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700"
                    >
                      <i class="fas fa-sign-out-alt mr-2"></i>ë¡œê·¸ì•„ì›ƒ
                    </button>
                  </div>
                </template>
                <template x-if="!user">
                  <div>
                    <button
                      @click="showLoginModal = true; userMenuOpen = false"
                      class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700"
                    >
                      <i class="fas fa-sign-in-alt mr-2"></i>ë¡œê·¸ì¸
                    </button>
                    <button
                      @click="showSignupModal = true; userMenuOpen = false"
                      class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700"
                    >
                      <i class="fas fa-user-plus mr-2"></i>íšŒì›ê°€ì…
                    </button>
                  </div>
                </template>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Market Indices -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <div class="glass rounded-xl p-4 slide-in-up">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-gray-600 dark:text-gray-400"
              >KOSPI</span
            >
            <i class="fas fa-chart-line text-gray-400"></i>
          </div>
          <div
            class="text-2xl font-bold text-gray-900 dark:text-white"
            x-text="marketIndices.kospi?.current_value || '-'"
          ></div>
          <div class="flex items-center mt-1">
            <i
              class="fas mr-1"
              :class="marketIndices.kospi?.change_rate >= 0 ? 'fa-caret-up text-red-500' : 'fa-caret-down text-blue-500'"
            ></i>
            <span
              class="text-sm font-medium"
              :class="marketIndices.kospi?.change_rate >= 0 ? 'text-red-500' : 'text-blue-500'"
              x-text="(marketIndices.kospi?.change_rate || 0) + '%'"
            ></span>
          </div>
        </div>

        <div
          class="glass rounded-xl p-4 slide-in-up"
          style="animation-delay: 0.1s"
        >
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-gray-600 dark:text-gray-400"
              >KOSDAQ</span
            >
            <i class="fas fa-chart-line text-gray-400"></i>
          </div>
          <div
            class="text-2xl font-bold text-gray-900 dark:text-white"
            x-text="marketIndices.kosdaq?.current_value || '-'"
          ></div>
          <div class="flex items-center mt-1">
            <i
              class="fas mr-1"
              :class="marketIndices.kosdaq?.change_rate >= 0 ? 'fa-caret-up text-red-500' : 'fa-caret-down text-blue-500'"
            ></i>
            <span
              class="text-sm font-medium"
              :class="marketIndices.kosdaq?.change_rate >= 0 ? 'text-red-500' : 'text-blue-500'"
              x-text="(marketIndices.kosdaq?.change_rate || 0) + '%'"
            ></span>
          </div>
        </div>

        <div
          class="glass rounded-xl p-4 slide-in-up"
          style="animation-delay: 0.2s"
        >
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-gray-600 dark:text-gray-400"
              >í™˜ìœ¨ (USD/KRW)</span
            >
            <i class="fas fa-dollar-sign text-gray-400"></i>
          </div>
          <div class="text-2xl font-bold text-gray-900 dark:text-white">
            1,324.50
          </div>
          <div class="flex items-center mt-1">
            <i class="fas fa-caret-up text-red-500 mr-1"></i>
            <span class="text-sm font-medium text-red-500">+0.35%</span>
          </div>
        </div>

        <div
          class="glass rounded-xl p-4 slide-in-up"
          style="animation-delay: 0.3s"
        >
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-gray-600 dark:text-gray-400"
              >ê¸ˆë¦¬</span
            >
            <i class="fas fa-percentage text-gray-400"></i>
          </div>
          <div class="text-2xl font-bold text-gray-900 dark:text-white">
            3.50%
          </div>
          <div class="flex items-center mt-1">
            <i class="fas fa-minus text-gray-500 mr-1"></i>
            <span class="text-sm font-medium text-gray-500">0.00%</span>
          </div>
        </div>
      </div>

      <!-- Tab Content -->
      <div x-show="activeTab === 'calendar'" x-transition>
        <div class="flex gap-6">
          <!-- Left Sidebar -->
          <div class="w-80 space-y-6">
            <!-- Quick Stats -->
            <div class="glass rounded-xl p-6">
              <h3
                class="text-lg font-semibold text-gray-900 dark:text-white mb-4"
              >
                ì˜¤ëŠ˜ì˜ ì¼ì •
              </h3>
              <div class="space-y-3">
                <div
                  class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg"
                >
                  <div class="flex items-center">
                    <div
                      class="w-2 h-2 bg-green-500 rounded-full mr-3"
                      :class="todayStats.earnings > 0 ? 'animate-pulse' : ''"
                    ></div>
                    <span
                      class="text-sm font-medium text-gray-700 dark:text-gray-300"
                      >ì‹¤ì ë°œí‘œ</span
                    >
                  </div>
                  <span
                    class="text-sm font-semibold text-green-600 dark:text-green-400"
                    x-text="todayStats.earnings + 'ê±´'"
                  ></span>
                </div>
                <div
                  class="flex items-center justify-between p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg"
                >
                  <div class="flex items-center">
                    <div 
                      class="w-2 h-2 bg-amber-500 rounded-full mr-3"
                      :class="todayStats.dividend > 0 ? 'animate-pulse' : ''"
                    ></div>
                    <span
                      class="text-sm font-medium text-gray-700 dark:text-gray-300"
                      >ë°°ë‹¹</span
                    >
                  </div>
                  <span
                    class="text-sm font-semibold text-amber-600 dark:text-amber-400"
                    x-text="todayStats.dividend + 'ê±´'"
                  ></span>
                </div>
                <div
                  class="flex items-center justify-between p-3 bg-teal-50 dark:bg-teal-900/20 rounded-lg"
                >
                  <div class="flex items-center">
                    <div 
                      class="w-2 h-2 bg-teal-500 rounded-full mr-3"
                      :class="todayStats.economic > 0 ? 'animate-pulse' : ''"
                    ></div>
                    <span
                      class="text-sm font-medium text-gray-700 dark:text-gray-300"
                      >ê²½ì œì§€í‘œ</span
                    >
                  </div>
                  <span
                    class="text-sm font-semibold text-teal-600 dark:text-teal-400"
                    x-text="todayStats.economic + 'ê±´'"
                  ></span>
                </div>
                <div
                  class="flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg"
                >
                  <div class="flex items-center">
                    <div 
                      class="w-2 h-2 bg-purple-500 rounded-full mr-3"
                      :class="todayStats.ipo > 0 ? 'animate-pulse' : ''"
                    ></div>
                    <span
                      class="text-sm font-medium text-gray-700 dark:text-gray-300"
                      >ì‹ ê·œìƒì¥</span
                    >
                  </div>
                  <span
                    class="text-sm font-semibold text-purple-600 dark:text-purple-400"
                    x-text="todayStats.ipo + 'ê±´'"
                  ></span>
                </div>
                <div
                  class="flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded-lg"
                >
                  <div class="flex items-center">
                    <div 
                      class="w-2 h-2 bg-red-500 rounded-full mr-3"
                      :class="todayStats.holiday > 0 ? 'animate-pulse' : ''"
                    ></div>
                    <span
                      class="text-sm font-medium text-gray-700 dark:text-gray-300"
                      >íœ´ì¥ì¼</span
                    >
                  </div>
                  <span
                    class="text-sm font-semibold text-red-600 dark:text-red-400"
                    x-text="todayStats.holiday + 'ê±´'"
                  ></span>
                </div>
              </div>
            </div>

            <!-- Filters -->
            <div class="glass rounded-xl p-6">
              <h3
                class="text-lg font-semibold text-gray-900 dark:text-white mb-4"
              >
                í•„í„°
              </h3>
              <div class="space-y-4">
                <div>
                  <label
                    class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block"
                    >ì´ë²¤íŠ¸ íƒ€ì…</label
                  >
                  <div class="space-y-2">
                    <template
                      x-for="eventType in eventTypes"
                      :key="eventType.id"
                    >
                      <label class="flex items-center group cursor-pointer">
                        <input
                          type="checkbox"
                          x-model="selectedEventTypes"
                          :value="eventType.id"
                          class="rounded border-gray-300 dark:border-gray-600 text-primary-600 focus:ring-primary-500 dark:bg-gray-700"
                        />
                        <span
                          class="ml-2 text-sm text-gray-700 dark:text-gray-300 group-hover:text-gray-900 dark:group-hover:text-white transition-colors"
                          x-text="eventType.name"
                        ></span>
                      </label>
                    </template>
                  </div>
                </div>

                <div>
                  <label class="flex items-center group cursor-pointer">
                    <input
                      type="checkbox"
                      x-model="bookmarkedOnly"
                      class="rounded border-gray-300 dark:border-gray-600 text-primary-600 focus:ring-primary-500 dark:bg-gray-700"
                    />
                    <span
                      class="ml-2 text-sm text-gray-700 dark:text-gray-300 group-hover:text-gray-900 dark:group-hover:text-white transition-colors"
                      >ë¶ë§ˆí¬í•œ ì¼ì •ë§Œ ë³´ê¸°</span
                    >
                  </label>
                </div>
              </div>
            </div>

            <!-- Upcoming Events -->
            <div class="glass rounded-xl p-6">
              <h3
                class="text-lg font-semibold text-gray-900 dark:text-white mb-4"
              >
                ë‹¤ê°€ì˜¤ëŠ” ì£¼ìš” ì¼ì •
              </h3>
              <div class="space-y-3" x-show="upcomingEvents.length > 0">
                <template x-for="event in upcomingEvents.slice(0, 5)" :key="event.id">
                  <div
                    class="border-l-4 pl-4 py-2 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-r cursor-pointer transition-colors"
                    :class="{
                      'border-green-500': event.extendedProps?.eventType === 'earnings',
                      'border-amber-500': event.extendedProps?.eventType === 'dividend',
                      'border-blue-500': event.extendedProps?.eventType === 'disclosure',
                      'border-red-500': event.extendedProps?.eventType === 'holiday',
                      'border-purple-500': event.extendedProps?.eventType === 'ipo',
                      'border-pink-500': event.extendedProps?.eventType === 'meeting',
                      'border-teal-500': event.extendedProps?.eventType === 'economic',
                      'border-gray-500': event.extendedProps?.eventType === 'personal'
                    }"
                    @click="selectUpcomingEvent(event)"
                  >
                    <div class="flex items-center justify-between">
                      <div>
                        <div class="text-sm font-semibold text-gray-900 dark:text-white" x-text="event.title"></div>
                        <div class="text-xs text-gray-500 dark:text-gray-400" x-text="formatEventDate(event.start)"></div>
                      </div>
                      <div class="flex items-center space-x-2">
                        <span 
                          class="px-2 py-1 text-xs font-medium rounded-full"
                          :class="{
                            'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400': event.extendedProps?.importance === 'high',
                            'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400': event.extendedProps?.importance === 'medium',
                            'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400': event.extendedProps?.importance === 'low'
                          }"
                          x-text="event.extendedProps?.importance === 'high' ? 'ë†’ìŒ' : event.extendedProps?.importance === 'medium' ? 'ë³´í†µ' : 'ë‚®ìŒ'"
                        ></span>
                        <button
                          @click.stop="explainEvent(event)"
                          class="text-purple-600 hover:text-purple-700 dark:text-purple-400 text-xs"
                        >
                          <i class="fas fa-robot"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
              <div x-show="upcomingEvents.length === 0" class="text-center py-4 text-gray-500 dark:text-gray-400">
                <i class="fas fa-calendar-times text-2xl mb-2"></i>
                <p class="text-sm">ë‹¤ê°€ì˜¤ëŠ” ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</p>
              </div>
            </div>
          </div>

          <!-- Calendar Container -->
          <div class="flex-1">
            <div class="glass rounded-xl p-6">
              <div id="calendar" class="fc-custom"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Market Tab -->
      <div x-show="activeTab === 'market'" x-transition>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Stock Price Chart -->
          <div class="glass rounded-xl p-6">
            <h3
              class="text-lg font-semibold text-gray-900 dark:text-white mb-4"
            >
              ì£¼ê°€ ì°¨íŠ¸
            </h3>
            <canvas id="stockChart" width="400" height="200"></canvas>
          </div>

          <!-- Program Trading -->
          <div class="glass rounded-xl p-6">
            <h3
              class="text-lg font-semibold text-gray-900 dark:text-white mb-4"
            >
              í”„ë¡œê·¸ë¨ ë§¤ë§¤ ë™í–¥
            </h3>
            <div class="space-y-2" x-show="programTrades.length > 0">
              <template
                x-for="trade in programTrades.slice(0, 5)"
                :key="trade.stock_code"
              >
                <div
                  class="flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg transition-colors"
                >
                  <div>
                    <div
                      class="font-medium text-gray-900 dark:text-white"
                      x-text="trade.stock_name"
                    ></div>
                    <div
                      class="text-xs text-gray-500 dark:text-gray-400"
                      x-text="trade.stock_code"
                    ></div>
                  </div>
                  <div class="text-right">
                    <div
                      class="font-medium"
                      :class="trade.program_net_amount > 0 ? 'text-red-600 dark:text-red-400' : 'text-blue-600 dark:text-blue-400'"
                      x-text="(trade.program_net_amount / 100000000).toFixed(1) + 'ì–µ'"
                    ></div>
                  </div>
                </div>
              </template>
            </div>
            <div
              x-show="programTrades.length === 0"
              class="text-center py-8 text-gray-500 dark:text-gray-400"
            >
              ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
            </div>
          </div>
        </div>
      </div>

      <!-- Watchlist Tab -->
      <div x-show="activeTab === 'watchlist'" x-transition>
        <div class="glass rounded-xl p-6">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white">
              ê´€ì‹¬ì¢…ëª©
            </h3>
            <button
              @click="showAddWatchlistModal = true"
              class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors"
            >
              <i class="fas fa-plus mr-2"></i>ì¢…ëª© ì¶”ê°€
            </button>
          </div>

          <div
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"
            x-show="watchlist.length > 0"
          >
            <template x-for="item in watchlist" :key="item.stock_code">
              <div
                class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:shadow-lg transition-all"
              >
                <div class="flex justify-between items-start mb-2">
                  <div>
                    <h4
                      class="font-semibold text-gray-900 dark:text-white"
                      x-text="item.stock_name"
                    ></h4>
                    <p
                      class="text-sm text-gray-500 dark:text-gray-400"
                      x-text="item.stock_code"
                    ></p>
                  </div>
                  <button
                    @click="removeFromWatchlist(item.id)"
                    class="text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors"
                  >
                    <i class="fas fa-times"></i>
                  </button>
                </div>
                <div
                  class="text-2xl font-bold text-gray-900 dark:text-white mb-1"
                >
                  52,300
                </div>
                <div class="flex items-center text-sm">
                  <i class="fas fa-caret-up text-red-500 mr-1"></i>
                  <span class="text-red-500">+2.35%</span>
                </div>
              </div>
            </template>
          </div>

          <div x-show="watchlist.length === 0" class="text-center py-12">
            <i
              class="fas fa-star text-4xl text-gray-300 dark:text-gray-600 mb-4"
            ></i>
            <p class="text-gray-500 dark:text-gray-400">ê´€ì‹¬ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        </div>
      </div>

      <!-- Global Tab -->
      <div x-show="activeTab === 'global'" x-transition>
        <div class="space-y-6">
          <!-- í•´ì™¸ ì£¼ì‹ -->
          <div class="glass rounded-xl p-6">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
              ğŸ‡ºğŸ‡¸ ë¯¸êµ­ ì£¼ì‹
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" x-show="globalData.us_stocks && globalData.us_stocks.length > 0">
              <template x-for="stock in globalData.us_stocks" :key="stock.symbol">
                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:shadow-lg transition-all">
                  <div class="flex justify-between items-start mb-2">
                    <div>
                      <h4 class="font-semibold text-gray-900 dark:text-white" x-text="stock.name"></h4>
                      <p class="text-sm text-gray-500 dark:text-gray-400" x-text="stock.symbol"></p>
                    </div>
                  </div>
                  <div class="text-2xl font-bold text-gray-900 dark:text-white mb-1" x-text="'$' + stock.price"></div>
                  <div class="flex items-center text-sm">
                    <i class="fas mr-1" :class="parseFloat(stock.change_rate) >= 0 ? 'fa-caret-up text-red-500' : 'fa-caret-down text-blue-500'"></i>
                    <span :class="parseFloat(stock.change_rate) >= 0 ? 'text-red-500' : 'text-blue-500'" x-text="stock.change_rate + '%'"></span>
                  </div>
                </div>
              </template>
            </div>
            <div x-show="!globalData.us_stocks || globalData.us_stocks.length === 0" class="text-center py-8 text-gray-500 dark:text-gray-400">
              ë¯¸êµ­ ì£¼ì‹ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
            </div>
          </div>

          <!-- ê°€ìƒí™”í -->
          <div class="glass rounded-xl p-6">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
              â‚¿ ê°€ìƒí™”í
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" x-show="globalData.cryptocurrencies && globalData.cryptocurrencies.length > 0">
              <template x-for="crypto in globalData.cryptocurrencies" :key="crypto.symbol">
                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:shadow-lg transition-all bg-gradient-to-br from-orange-50 to-yellow-50 dark:from-orange-900/20 dark:to-yellow-900/20 cursor-pointer"
                     @click="explainCrypto(crypto)">
                  <div class="flex justify-between items-start mb-2">
                    <div>
                      <h4 class="font-semibold text-gray-900 dark:text-white" x-text="crypto.symbol"></h4>
                      <p class="text-sm text-gray-500 dark:text-gray-400">ê°€ìƒí™”í</p>
                    </div>
                    <button
                      @click.stop="explainCrypto(crypto)"
                      class="text-purple-600 hover:text-purple-700 dark:text-purple-400 text-sm"
                    >
                      <i class="fas fa-robot"></i>
                    </button>
                  </div>
                  <div class="text-2xl font-bold text-gray-900 dark:text-white mb-1" x-text="crypto.price.toLocaleString() + 'ì›'"></div>
                  <div class="flex items-center justify-between">
                    <div class="flex items-center text-sm">
                      <i class="fas mr-1" :class="crypto.change_rate >= 0 ? 'fa-caret-up text-red-500' : 'fa-caret-down text-blue-500'"></i>
                      <span :class="crypto.change_rate >= 0 ? 'text-red-500' : 'text-blue-500'" x-text="crypto.change_rate.toFixed(2) + '%'"></span>
                    </div>
                    <span class="text-xs text-purple-600 dark:text-purple-400 font-medium">ìì„¸íˆ ë³´ê¸°</span>
                  </div>
                </div>
              </template>
            </div>
            <div x-show="!globalData.cryptocurrencies || globalData.cryptocurrencies.length === 0" class="text-center py-8 text-gray-500 dark:text-gray-400">
              ê°€ìƒí™”í ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
            </div>
          </div>

          <!-- í™˜ìœ¨ -->
          <div class="glass rounded-xl p-6">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
              ğŸ’± í™˜ìœ¨ ì •ë³´
            </h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4" x-show="globalData.exchange_rates && globalData.exchange_rates.length > 0">
              <template x-for="rate in globalData.exchange_rates" :key="rate.currency">
                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 text-center hover:shadow-lg transition-all bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20">
                  <div class="text-lg font-semibold text-gray-900 dark:text-white mb-1" x-text="rate.currency + '/KRW'"></div>
                  <div class="text-xl font-bold text-blue-600 dark:text-blue-400" x-text="rate.rate.toLocaleString()"></div>
                </div>
              </template>
            </div>
            <div x-show="!globalData.exchange_rates || globalData.exchange_rates.length === 0" class="text-center py-8 text-gray-500 dark:text-gray-400">
              í™˜ìœ¨ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
            </div>
          </div>

          <!-- ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì •ë³´ -->
          <div class="glass rounded-xl p-4">
            <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
              <span>ì‹¤ì‹œê°„ ë°ì´í„° (30ì´ˆë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸)</span>
              <span x-show="lastGlobalUpdate" x-text="'ìµœì¢… ì—…ë°ì´íŠ¸: ' + lastGlobalUpdate"></span>
            </div>
          </div>
        </div>
      </div>

      <!-- ê³µì‹œì •ë³´ Tab -->
      <div x-show="activeTab === 'disclosures'" x-transition>
        <div class="space-y-6">
          <!-- ê³µì‹œ ê²€ìƒ‰ -->
          <div class="glass rounded-xl p-6">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
              ğŸ” ê³µì‹œ ê²€ìƒ‰
            </h3>
            <div class="flex flex-col sm:flex-row gap-4 mb-6">
              <div class="flex-1">
                <input
                  type="text"
                  x-model="disclosureSearch.companyName"
                  placeholder="íšŒì‚¬ëª… ê²€ìƒ‰ (ì˜ˆ: ì‚¼ì„±ì „ì)"
                  class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                  @keyup.enter="searchDisclosures()"
                />
              </div>
              <select 
                x-model="disclosureSearch.corpCls"
                class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
              >
                <option value="Y">ìœ ê°€ì¦ê¶Œ</option>
                <option value="K">ì½”ìŠ¤ë‹¥</option>
                <option value="N">ì½”ë„¥ìŠ¤</option>
                <option value="">ì „ì²´</option>
              </select>
              <select 
                x-model="disclosureSearch.days"
                class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
              >
                <option value="7">ìµœê·¼ 7ì¼</option>
                <option value="14">ìµœê·¼ 14ì¼</option>
                <option value="30">ìµœê·¼ 30ì¼</option>
              </select>
              <button
                @click="searchDisclosures()"
                class="btn-primary px-6 py-2 rounded-lg transition-all"
                :disabled="disclosureLoading"
              >
                <i class="fas fa-search mr-2"></i>
                <span x-show="!disclosureLoading">ê²€ìƒ‰</span>
                <span x-show="disclosureLoading">
                  <i class="fas fa-spinner fa-spin mr-2"></i>ê²€ìƒ‰ì¤‘...
                </span>
              </button>
            </div>
          </div>

          <!-- ìµœê·¼ ì¤‘ìš” ê³µì‹œ -->
          <div class="glass rounded-xl p-6">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                ğŸ“„ ìµœê·¼ ì¤‘ìš” ê³µì‹œ
              </h3>
              <button
                @click="loadRecentDisclosures()"
                class="text-primary-600 hover:text-primary-700 dark:text-primary-400 text-sm"
                :disabled="disclosureLoading"
              >
                <i class="fas fa-sync-alt mr-1" :class="{ 'fa-spin': disclosureLoading }"></i>
                ìƒˆë¡œê³ ì¹¨
              </button>
            </div>
            
            <div x-show="disclosures && disclosures.length > 0" class="space-y-4">
              <template x-for="disclosure in disclosures" :key="disclosure.rcept_no">
                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:shadow-lg transition-all cursor-pointer bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20"
                     @click="viewDisclosureDetail(disclosure)">
                  <div class="flex justify-between items-start mb-2">
                    <div class="flex-1">
                      <h4 class="font-semibold text-gray-900 dark:text-white text-lg mb-1" x-text="disclosure.corp_name"></h4>
                      <p class="text-sm text-gray-600 dark:text-gray-300 mb-2" x-text="disclosure.report_nm"></p>
                      <div class="flex items-center space-x-4 text-xs text-gray-500 dark:text-gray-400">
                        <span x-text="'ì ‘ìˆ˜ì¼: ' + disclosure.rcept_dt.replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3')"></span>
                        <span x-text="'ì œì¶œì¸: ' + disclosure.flr_nm"></span>
                        <span x-show="disclosure.stock_code" class="bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300 px-2 py-1 rounded" x-text="disclosure.stock_code"></span>
                        <span class="bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 px-2 py-1 rounded" x-text="disclosure.corp_cls === 'Y' ? 'ìœ ê°€' : disclosure.corp_cls === 'K' ? 'ì½”ìŠ¤ë‹¥' : 'ê¸°íƒ€'"></span>
                      </div>
                    </div>
                    <div class="flex items-center space-x-2">
                      <button
                        @click.stop="explainDisclosure(disclosure)"
                        class="text-purple-600 hover:text-purple-700 dark:text-purple-400 p-2 rounded hover:bg-purple-100 dark:hover:bg-purple-900/50 transition-colors"
                        title="AI ì„¤ëª…"
                      >
                        <i class="fas fa-robot"></i>
                      </button>
                      <i class="fas fa-external-link-alt text-gray-400"></i>
                    </div>
                  </div>
                </div>
              </template>
            </div>
            
            <div x-show="!disclosures || disclosures.length === 0" class="text-center py-8">
              <div x-show="disclosureLoading" class="text-gray-500 dark:text-gray-400">
                <i class="fas fa-spinner fa-spin mr-2"></i>
                ê³µì‹œì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
              </div>
              <div x-show="!disclosureLoading" class="text-gray-500 dark:text-gray-400">
                ê³µì‹œì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.
              </div>
            </div>
          </div>

          <!-- ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì •ë³´ -->
          <div class="glass rounded-xl p-4">
            <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
              <span>DART ì „ìê³µì‹œì‹œìŠ¤í…œ ì—°ë™ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸)</span>
              <span x-show="lastDisclosureUpdate" x-text="'ìµœì¢… ì—…ë°ì´íŠ¸: ' + lastDisclosureUpdate"></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Analysis Tab -->
      <div x-show="activeTab === 'analysis'" x-transition>
        <div class="space-y-6">
          <!-- ì˜¤ëŠ˜ì˜ ì‹œì¥ ì´ìŠˆ -->
          <div class="glass rounded-xl p-6">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                ğŸ“ˆ ì˜¤ëŠ˜ì˜ ì‹œì¥ ì´ìŠˆ
              </h3>
              <button
                @click="loadDailyMarketSummary()"
                class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors text-sm"
              >
                <i class="fas fa-refresh mr-2"></i>ìƒˆë¡œê³ ì¹¨
              </button>
            </div>
            
            <div x-show="dailyMarketSummary" class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-4">
              <div class="flex items-start space-x-3">
                <i class="fas fa-robot text-blue-600 dark:text-blue-400 text-lg mt-1"></i>
                <div class="flex-1">
                  <h4 class="font-semibold text-gray-900 dark:text-white mb-2" x-text="'AI ì‹œì¥ ë¶„ì„ - ' + (dailyMarketSummary?.date || '')"></h4>
                  <div class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed whitespace-pre-line" x-text="dailyMarketSummary?.summary || 'ì‹œì¥ ìš”ì•½ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...'"></div>
                </div>
              </div>
            </div>
            
            <div x-show="!dailyMarketSummary" class="text-center py-8">
              <div class="loading-spinner mx-auto mb-4"></div>
              <p class="text-gray-500 dark:text-gray-400">AIê°€ ì˜¤ëŠ˜ì˜ ì‹œì¥ ì´ìŠˆë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
            </div>
          </div>

          <!-- AI íˆ¬ì ë„ìš°ë¯¸ -->
          <div class="glass rounded-xl p-6">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
              ğŸ¤– AI íˆ¬ì ë„ìš°ë¯¸
            </h3>
            <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg p-4">
              <div class="flex items-center space-x-3 mb-4">
                <i class="fas fa-lightbulb text-purple-600 dark:text-purple-400 text-lg"></i>
                <h4 class="font-semibold text-gray-900 dark:text-white">ê¸ˆìœµ ìš©ì–´ê°€ ì–´ë ¤ìš°ì‹ ê°€ìš”?</h4>
              </div>
              <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
                ìº˜ë¦°ë” ì´ë²¤íŠ¸ë‚˜ ì¢…ëª© ì •ë³´ì—ì„œ <span class="font-semibold text-purple-600 dark:text-purple-400">"ì•Œì•„ë³´ê¸°"</span> ë²„íŠ¼ì„ í´ë¦­í•˜ì‹œë©´ 
                AIê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ì‰½ê³  ëª…í™•í•˜ê²Œ ì„¤ëª…í•´ë“œë¦½ë‹ˆë‹¤.
              </p>
              <div class="flex items-center space-x-2 text-xs text-gray-500 dark:text-gray-400">
                <i class="fas fa-info-circle"></i>
                <span>Perplexity AI ê¸°ë°˜ ì‹¤ì‹œê°„ ì •ë³´ ì œê³µ</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Event Detail Modal -->
    <div
      x-show="showEventModal"
      x-cloak
      class="fixed inset-0 z-50 overflow-y-auto"
      aria-labelledby="modal-title"
      role="dialog"
      aria-modal="true"
    >
      <div
        class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
      >
        <div
          x-show="showEventModal"
          x-transition:enter="ease-out duration-300"
          x-transition:enter-start="opacity-0"
          x-transition:enter-end="opacity-100"
          x-transition:leave="ease-in duration-200"
          x-transition:leave-start="opacity-100"
          x-transition:leave-end="opacity-0"
          class="fixed inset-0 bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 transition-opacity"
          aria-hidden="true"
          @click="showEventModal = false"
        ></div>

        <div
          x-show="showEventModal"
          x-transition:enter="ease-out duration-300"
          x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
          x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
          x-transition:leave="ease-in duration-200"
          x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
          x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
          class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
        >
          <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
            <div class="flex items-center justify-between mb-4">
              <h3
                class="text-xl font-bold text-gray-900 dark:text-white"
                x-text="selectedEvent?.title"
              ></h3>
              <button
                @click="showEventModal = false"
                class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 transition-colors"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>

            <div class="space-y-4">
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <p class="text-sm text-gray-500 dark:text-gray-400">ë‚ ì§œ</p>
                  <p
                    class="text-base font-medium text-gray-900 dark:text-white"
                    x-text="selectedEvent?.date"
                  ></p>
                </div>
                <div x-show="selectedEvent?.time">
                  <p class="text-sm text-gray-500 dark:text-gray-400">ì‹œê°„</p>
                  <p
                    class="text-base font-medium text-gray-900 dark:text-white"
                    x-text="selectedEvent?.time"
                  ></p>
                </div>
              </div>

              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">ì„¤ëª…</p>
                <p
                  class="text-base text-gray-700 dark:text-gray-300"
                  x-text="selectedEvent?.description"
                ></p>
              </div>

              <div x-show="selectedEvent?.details">
                <p class="text-sm text-gray-500 dark:text-gray-400">ìƒì„¸ ì •ë³´</p>
                <p
                  class="text-base text-gray-700 dark:text-gray-300 whitespace-pre-line"
                  x-text="selectedEvent?.details"
                ></p>
              </div>

              <div x-show="selectedEvent?.stockCode">
                <p class="text-sm text-gray-500 dark:text-gray-400">ê´€ë ¨ ì¢…ëª©</p>
                <div class="flex items-center justify-between bg-gray-50 dark:bg-gray-700 rounded-lg p-3 mt-1">
                  <div>
                    <p class="text-base font-medium text-gray-900 dark:text-white">
                      <span x-text="selectedEvent?.stockName"></span>
                      <span
                        class="text-sm text-gray-500 dark:text-gray-400 ml-1"
                        x-text="`(${selectedEvent?.stockCode})`"
                      ></span>
                    </p>
                    <p 
                      x-show="selectedEvent?.currentPrice"
                      class="text-sm text-gray-600 dark:text-gray-400"
                      x-text="`í˜„ì¬ê°€: ${selectedEvent?.currentPrice}ì›`"
                    ></p>
                  </div>
                  <div class="flex space-x-2">
                    <button
                      @click="showStockDetail(selectedEvent)"
                      class="text-primary-600 hover:text-primary-700 dark:text-primary-400 text-sm font-medium"
                    >
                      ì°¨íŠ¸ ë³´ê¸°
                    </button>
                    <button
                      @click="explainStock(selectedEvent)"
                      class="text-purple-600 hover:text-purple-700 dark:text-purple-400 text-sm font-medium"
                    >
                      <i class="fas fa-robot mr-1"></i>AI ë¶„ì„
                    </button>
                  </div>
                </div>
              </div>

              <div x-show="selectedEvent?.location">
                <p class="text-sm text-gray-500 dark:text-gray-400">ì¥ì†Œ</p>
                <p
                  class="text-base text-gray-700 dark:text-gray-300"
                  x-text="selectedEvent?.location"
                ></p>
              </div>

              <div x-show="selectedEvent?.importance">
                <p class="text-sm text-gray-500 dark:text-gray-400">ì¤‘ìš”ë„</p>
                <div class="flex items-center mt-1">
                  <span 
                    class="px-2 py-1 text-xs font-medium rounded-full"
                    :class="{
                      'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400': selectedEvent?.importance === 'high',
                      'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400': selectedEvent?.importance === 'medium',
                      'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400': selectedEvent?.importance === 'low'
                    }"
                    x-text="selectedEvent?.importance === 'high' ? 'ë†’ìŒ' : selectedEvent?.importance === 'medium' ? 'ë³´í†µ' : 'ë‚®ìŒ'"
                  ></span>
                </div>
              </div>

              <div class="pt-4 space-y-3">
                <!-- AI ì„¤ëª… ë²„íŠ¼ -->
                <button
                  @click="explainEvent(selectedEvent)"
                  class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:from-purple-700 hover:to-blue-700 transition-all"
                >
                  <i class="fas fa-robot mr-2"></i>AIë¡œ ìì„¸íˆ ì•Œì•„ë³´ê¸°
                </button>
                
                <!-- ê¸°ì¡´ ë²„íŠ¼ë“¤ -->
                <div class="flex space-x-3">
                  <button
                    @click="toggleBookmark(selectedEvent)"
                    class="flex-1 bg-primary-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-primary-700 transition-colors"
                  >
                    <i class="fas fa-bookmark mr-2"></i>ë¶ë§ˆí¬
                  </button>
                  <button
                    class="flex-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                  >
                    <i class="fas fa-share-alt mr-2"></i>ê³µìœ 
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Login Modal -->
    <div
      x-show="showLoginModal"
      x-cloak
      class="fixed inset-0 z-50 overflow-y-auto"
      aria-labelledby="modal-title"
      role="dialog"
      aria-modal="true"
    >
      <div
        class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
      >
        <div
          x-show="showLoginModal"
          x-transition:enter="ease-out duration-300"
          x-transition:enter-start="opacity-0"
          x-transition:enter-end="opacity-100"
          x-transition:leave="ease-in duration-200"
          x-transition:leave-start="opacity-100"
          x-transition:leave-end="opacity-0"
          class="fixed inset-0 bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 transition-opacity"
          aria-hidden="true"
          @click="showLoginModal = false"
        ></div>

        <div
          x-show="showLoginModal"
          x-transition:enter="ease-out duration-300"
          x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
          x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
          x-transition:leave="ease-in duration-200"
          x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
          x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
          class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full"
        >
          <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6">
            <div class="text-center mb-6">
              <i class="fas fa-chart-line text-primary-600 text-4xl mb-4"></i>
              <h3 class="text-2xl font-bold text-gray-900 dark:text-white">
                InvestCalendar ë¡œê·¸ì¸
              </h3>
              <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">
                ìŠ¤ë§ˆíŠ¸í•œ íˆ¬ì ì¼ì • ê´€ë¦¬ë¥¼ ì‹œì‘í•˜ì„¸ìš”
              </p>
            </div>

            <form @submit.prevent="login()" class="space-y-4">
              <div>
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >ì´ë©”ì¼ ë˜ëŠ” ì‚¬ìš©ìëª…</label
                >
                <input
                  type="text"
                  x-model="loginForm.username"
                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"
                  placeholder="your@email.com"
                  required
                />
              </div>

              <div>
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >ë¹„ë°€ë²ˆí˜¸</label
                >
                <input
                  type="password"
                  x-model="loginForm.password"
                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                  required
                />
              </div>

              <div class="flex items-center justify-between">
                <label class="flex items-center">
                  <input
                    type="checkbox"
                    class="rounded border-gray-300 dark:border-gray-600 text-primary-600 focus:ring-primary-500 dark:bg-gray-700"
                  />
                  <span class="ml-2 text-sm text-gray-700 dark:text-gray-300"
                    >ë¡œê·¸ì¸ ìœ ì§€</span
                  >
                </label>
                <a
                  href="#"
                  class="text-sm text-primary-600 hover:text-primary-500 dark:text-primary-400 dark:hover:text-primary-300"
                  >ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a
                >
              </div>

              <button
                type="submit"
                :disabled="isLoading"
                class="w-full bg-primary-600 text-white py-2 rounded-lg font-medium hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <span x-show="!isLoading">ë¡œê·¸ì¸</span>
                <span
                  x-show="isLoading"
                  class="flex items-center justify-center"
                >
                  <div class="loading-spinner w-5 h-5 mr-2"></div>
                  ë¡œê·¸ì¸ ì¤‘...
                </span>
              </button>

              <div class="relative">
                <div class="absolute inset-0 flex items-center">
                  <div
                    class="w-full border-t border-gray-300 dark:border-gray-600"
                  ></div>
                </div>
                <div class="relative flex justify-center text-sm">
                  <span
                    class="px-2 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400"
                    >ë˜ëŠ”</span
                  >
                </div>
              </div>

              <button
                type="button"
                class="w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors flex items-center justify-center"
              >
                <img
                  src="https://www.google.com/favicon.ico"
                  class="w-5 h-5 mr-2"
                />
                Googleë¡œ ê³„ì†í•˜ê¸°
              </button>

              <p class="text-center text-sm text-gray-500 dark:text-gray-400">
                ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?
                <button
                  type="button"
                  @click="showLoginModal = false; showSignupModal = true"
                  class="text-primary-600 hover:text-primary-500 dark:text-primary-400 dark:hover:text-primary-300 font-medium"
                >
                  íšŒì›ê°€ì…
                </button>
              </p>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Signup Modal -->
    <div
      x-show="showSignupModal"
      x-cloak
      class="fixed inset-0 z-50 overflow-y-auto"
      aria-labelledby="modal-title"
      role="dialog"
      aria-modal="true"
    >
      <div
        class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
      >
        <div
          x-show="showSignupModal"
          x-transition:enter="ease-out duration-300"
          x-transition:enter-start="opacity-0"
          x-transition:enter-end="opacity-100"
          x-transition:leave="ease-in duration-200"
          x-transition:leave-start="opacity-100"
          x-transition:leave-end="opacity-0"
          class="fixed inset-0 bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 transition-opacity"
          aria-hidden="true"
          @click="showSignupModal = false"
        ></div>

        <div
          x-show="showSignupModal"
          x-transition:enter="ease-out duration-300"
          x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
          x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
          x-transition:leave="ease-in duration-200"
          x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
          x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
          class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full"
        >
          <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6">
            <div class="text-center mb-6">
              <i class="fas fa-user-plus text-primary-600 text-4xl mb-4"></i>
              <h3 class="text-2xl font-bold text-gray-900 dark:text-white">
                íšŒì›ê°€ì…
              </h3>
              <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">
                InvestCalendarì™€ í•¨ê»˜ ì‹œì‘í•˜ì„¸ìš”
              </p>
            </div>

            <form @submit.prevent="signup()" class="space-y-4">
              <div>
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >ì´ë©”ì¼</label
                >
                <input
                  type="email"
                  x-model="signupForm.email"
                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"
                  placeholder="your@email.com"
                  required
                />
              </div>

              <div>
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >ì‚¬ìš©ìëª…</label
                >
                <input
                  type="text"
                  x-model="signupForm.username"
                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"
                  placeholder="username"
                  required
                />
              </div>

              <div>
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >ì´ë¦„</label
                >
                <input
                  type="text"
                  x-model="signupForm.full_name"
                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"
                  placeholder="í™ê¸¸ë™"
                />
              </div>

              <div>
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >ë¹„ë°€ë²ˆí˜¸</label
                >
                <input
                  type="password"
                  x-model="signupForm.password"
                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                  required
                />
              </div>

              <button
                type="submit"
                :disabled="isLoading"
                class="w-full bg-primary-600 text-white py-2 rounded-lg font-medium hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <span x-show="!isLoading">ê°€ì…í•˜ê¸°</span>
                <span
                  x-show="isLoading"
                  class="flex items-center justify-center"
                >
                  <div class="loading-spinner w-5 h-5 mr-2"></div>
                  ê°€ì… ì¤‘...
                </span>
              </button>

              <p class="text-center text-sm text-gray-500 dark:text-gray-400">
                ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?
                <button
                  type="button"
                  @click="showSignupModal = false; showLoginModal = true"
                  class="text-primary-600 hover:text-primary-500 dark:text-primary-400 dark:hover:text-primary-300 font-medium"
                >
                  ë¡œê·¸ì¸
                </button>
              </p>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- AI Explanation Modal -->
    <div
      x-show="showAiExplanationModal"
      x-cloak
      class="fixed inset-0 z-50 overflow-y-auto"
      aria-labelledby="ai-modal-title"
      role="dialog"
      aria-modal="true"
    >
      <div
        class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
      >
        <div
          x-show="showAiExplanationModal"
          x-transition:enter="ease-out duration-300"
          x-transition:enter-start="opacity-0"
          x-transition:enter-end="opacity-100"
          x-transition:leave="ease-in duration-200"
          x-transition:leave-start="opacity-100"
          x-transition:leave-end="opacity-0"
          class="fixed inset-0 bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 transition-opacity"
          aria-hidden="true"
          @click="showAiExplanationModal = false"
        ></div>

        <div
          x-show="showAiExplanationModal"
          x-transition:enter="ease-out duration-300"
          x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
          x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
          x-transition:leave="ease-in duration-200"
          x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
          x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
          class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full"
        >
          <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center space-x-3">
                <div class="flex-shrink-0">
                  <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center">
                    <i class="fas fa-robot text-white text-lg"></i>
                  </div>
                </div>
                <div>
                  <h3 class="text-lg font-bold text-gray-900 dark:text-white">
                    AI íˆ¬ì ë„ìš°ë¯¸
                  </h3>
                  <p class="text-sm text-gray-500 dark:text-gray-400">
                    Perplexity AIê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ì„¤ëª…í•´ë“œë¦½ë‹ˆë‹¤
                  </p>
                </div>
              </div>
              <button
                @click="showAiExplanationModal = false"
                class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 transition-colors"
              >
                <i class="fas fa-times text-xl"></i>
              </button>
            </div>

            <div class="space-y-4">
              <!-- ì§ˆë¬¸/ì£¼ì œ -->
              <div x-show="aiExplanation?.term || aiExplanation?.event || aiExplanation?.stock_name">
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                  <h4 class="font-semibold text-gray-900 dark:text-white mb-2">
                    <i class="fas fa-question-circle text-blue-600 dark:text-blue-400 mr-2"></i>
                    ì§ˆë¬¸
                  </h4>
                  <p class="text-gray-700 dark:text-gray-300" x-text="aiExplanation?.term || aiExplanation?.event || aiExplanation?.stock_name || ''"></p>
                </div>
              </div>

              <!-- AI ë‹µë³€ -->
              <div>
                <div class="bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg p-4">
                  <h4 class="font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
                    <i class="fas fa-brain text-purple-600 dark:text-purple-400 mr-2"></i>
                    AI ì„¤ëª…
                    <span x-show="isAiLoading" class="ml-2 text-sm text-purple-600 dark:text-purple-400 animate-pulse">ë¶„ì„ ì¤‘...</span>
                  </h4>
                  
                  <!-- AI ë¡œë”© ìƒíƒœ -->
                  <div x-show="isAiLoading" class="py-8 fade-in-scale">
                    <div class="flex flex-col items-center space-y-4">
                      <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-purple-600 rounded-full ai-loading-dot"></div>
                        <div class="w-3 h-3 bg-purple-600 rounded-full ai-loading-dot"></div>
                        <div class="w-3 h-3 bg-purple-600 rounded-full ai-loading-dot"></div>
                      </div>
                      <div class="text-center">
                        <p class="text-purple-600 dark:text-purple-400 font-medium">ğŸ¤– AIê°€ ì—´ì‹¬íˆ ë¶„ì„í•˜ê³  ìˆì–´ìš”</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>
                      </div>
                    </div>
                  </div>
                  
                  <!-- AI ë‹µë³€ ë‚´ìš© -->
                  <div x-show="!isAiLoading && aiExplanation" class="fade-in-scale">
                    <p class="text-gray-700 dark:text-gray-300 leading-relaxed whitespace-pre-line" 
                       x-text="aiExplanation?.explanation || aiExplanation?.analysis || aiExplanation?.content || 'ì„¤ëª…ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'">
                    </p>
                    
                    <!-- AI ì‘ë‹µ ì¶œì²˜ -->
                    <div x-show="aiExplanation?.source" class="mt-3 pt-3 border-t border-purple-200 dark:border-purple-700">
                      <p class="text-xs text-purple-600 dark:text-purple-400">
                        <i class="fas fa-external-link-alt mr-1"></i>
                        ì¶œì²˜: <span x-text="aiExplanation?.source"></span>
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- í”¼ë“œë°± -->
              <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                  <p class="text-xs text-gray-500 dark:text-gray-400">
                    <i class="fas fa-info-circle mr-1"></i>
                    ì´ ì„¤ëª…ì´ ë„ì›€ë˜ì…¨ë‚˜ìš”?
                  </p>
                  <div class="flex space-x-2">
                    <button class="text-green-600 hover:text-green-700 dark:text-green-400 text-sm">
                      <i class="fas fa-thumbs-up mr-1"></i>ë„ì›€ë¨
                    </button>
                    <button class="text-red-600 hover:text-red-700 dark:text-red-400 text-sm">
                      <i class="fas fa-thumbs-down mr-1"></i>ì•„ë‹ˆì˜¤
                    </button>
                  </div>
                </div>
              </div>

              <!-- ë‹«ê¸° ë²„íŠ¼ -->
              <div class="pt-4">
                <button
                  @click="showAiExplanationModal = false"
                  class="w-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                >
                  ë‹«ê¸°
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      function calendarApp() {
        return {
          // Dark mode
          darkMode: localStorage.getItem("darkMode") === "true",

          // Navigation
          activeTab: "calendar",

          // User
          user: null,

          // Modals
          showEventModal: false,
          showLoginModal: false,
          showSignupModal: false,
          showAddWatchlistModal: false,
          showAiExplanationModal: false,

          // Loading
          isLoading: false,
          isAiLoading: false,

          // AI Features
          dailyMarketSummary: null,
          aiExplanation: null,

          // Today's events and upcoming events
          todayStats: {
            earnings: 0,
            dividend: 0,
            economic: 0,
            ipo: 0,
            holiday: 0
          },
          upcomingEvents: [],

          // Calendar
          calendar: null,
          selectedEvent: null,
          selectedEventTypes: [
            "earnings",
            "dividend", 
            "disclosure",
            "holiday",
            "economic",
            "crypto",
            "price_alert"
          ],
          bookmarkedOnly: false,
          eventTypes: [
            { id: "earnings", name: "ì‹¤ì ë°œí‘œ", color: "#10b981" },
            { id: "dividend", name: "ë°°ë‹¹", color: "#f59e0b" },
            { id: "disclosure", name: "ê³µì‹œ", color: "#3b82f6" },
            { id: "holiday", name: "íœ´ì¥ì¼", color: "#ef4444" },
            { id: "ipo", name: "IPO", color: "#8b5cf6" },
            { id: "meeting", name: "ì£¼ì£¼ì´íšŒ", color: "#ec4899" },
            { id: "economic", name: "ê²½ì œì§€í‘œ", color: "#14b8a6" },
            { id: "personal", name: "ê°œì¸ì¼ì •", color: "#6b7280" },
          ],

          // Market data
          marketIndices: {
            kospi: { current_value: 0, change_rate: 0, change_value: 0 },
            kosdaq: { current_value: 0, change_rate: 0, change_value: 0 },
          },
          programTrades: [],
          topStocks: [],

          // Global data
          globalData: {
            us_stocks: [],
            cryptocurrencies: [],
            exchange_rates: []
          },
          lastGlobalUpdate: null,

          // Search
          searchQuery: "",
          searchResults: [],

          // Watchlist
          watchlist: [],

          // DART ê³µì‹œì •ë³´
          disclosures: [],
          disclosureLoading: false,
          disclosureSearch: {
            companyName: '',
            corpCls: 'Y',
            days: 7
          },
          lastDisclosureUpdate: null,

          // Forms
          loginForm: {
            username: "",
            password: "",
          },
          signupForm: {
            email: "",
            username: "",
            full_name: "",
            password: "",
          },

          // Chart
          stockChart: null,

          init() {
            // Dark mode persistence
            this.$watch("darkMode", (value) => {
              localStorage.setItem("darkMode", value);
              // HTML í´ë˜ìŠ¤ì—ë„ ì ìš©
              if (value) {
                document.documentElement.classList.add('dark');
              } else {
                document.documentElement.classList.remove('dark');
              }
            });

            // ì´ˆê¸° ë‹¤í¬ëª¨ë“œ ìƒíƒœ ì ìš©
            if (this.darkMode) {
              document.documentElement.classList.add('dark');
            }

            // Initialize components
            this.initCalendar();
            this.loadMarketData();
            this.loadEvents();
            this.loadGlobalData();
            this.loadDailyMarketSummary();
            this.loadRecentDisclosures();
            this.checkAuth();

            // Update market data every 30 seconds
            setInterval(() => {
              if (
                this.activeTab === "market" ||
                this.activeTab === "calendar"
              ) {
                this.loadMarketData();
              }
              
              if (this.activeTab === "global") {
                this.loadGlobalData();
              }
            }, 30000);

            // Watch for filter changes to reload events
            this.$watch('selectedEventTypes', () => {
              this.loadEvents();
            });

            this.$watch('bookmarkedOnly', () => {
              this.loadEvents();
            });
          },

          initCalendar() {
            const calendarEl = document.getElementById("calendar");
            this.calendar = new FullCalendar.Calendar(calendarEl, {
              initialView: "dayGridMonth",
              locale: "ko",
              height: "auto",
              aspectRatio: 1.35,
              headerToolbar: {
                left: "prev,next today",
                center: "title",
                right: "dayGridMonth,dayGridWeek,dayGridDay",
              },
              buttonText: {
                today: "ì˜¤ëŠ˜",
                month: "ì›”",
                week: "ì£¼",
                day: "ì¼",
                list: "ëª©ë¡"
              },
              // ëª¨ë˜í•œ ìŠ¤íƒ€ì¼ë§
              eventDisplay: 'block',
              eventMinHeight: 20,
              eventClassNames: 'rounded-lg text-xs font-medium shadow-sm hover:shadow-md transition-shadow',
              dayCellClassNames: 'hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors',
              dayHeaderClassNames: 'text-gray-600 dark:text-gray-300 font-semibold text-sm',
              eventClick: (info) => {
                this.selectedEvent = {
                  id: info.event.id,
                  title: info.event.title,
                  date: info.event.start.toLocaleDateString("ko-KR"),
                  description: info.event.extendedProps.description,
                  stockCode: info.event.extendedProps.stockCode,
                  stockName: info.event.extendedProps.stockName,
                  eventType: info.event.extendedProps.eventType,
                  importance: info.event.extendedProps.importance,
                  details: info.event.extendedProps.details,
                  time: info.event.extendedProps.time,
                  location: info.event.extendedProps.location,
                  currentPrice: info.event.extendedProps.currentPrice,
                  isBookmarked: info.event.extendedProps.isBookmarked,
                };
                this.showEventModal = true;
              },
              events: [],
            });
            this.calendar.render();
          },

          async loadEvents() {
            try {
              const startDate = new Date();
              startDate.setMonth(startDate.getMonth() - 2);  // 2ê°œì›” ì „ë¶€í„°
              const endDate = new Date();
              endDate.setMonth(endDate.getMonth() + 6);      // 6ê°œì›” í›„ê¹Œì§€

              const params = new URLSearchParams({
                start_date: startDate.toISOString().split('T')[0],
                end_date: endDate.toISOString().split('T')[0]
              });

              // ìƒˆë¡œìš´ í¬ê´„ì ì¸ ì´ë²¤íŠ¸ API ì‚¬ìš©
              const response = await fetch(
                `/api/v1/stocks/calendar/all-events?${params}`
              );
              
              if (response.ok) {
                const result = await response.json();
                console.log(`ğŸ“… í¬ê´„ì ì¸ ì´ë²¤íŠ¸ ë¡œë”© ì™„ë£Œ: ${result.total_events}ê°œ`);
                console.log("ğŸ“Š ì´ë²¤íŠ¸ íƒ€ì…ë³„ ê°œìˆ˜:", result.event_types);
                
                const events = result.events || [];
                
                // í•„í„°ë§ëœ ì´ë²¤íŠ¸ë§Œ í‘œì‹œ
                const filteredEvents = events.filter(event => {
                  const eventType = event.extendedProps?.eventType;
                  return this.selectedEventTypes.includes(eventType);
                });

                this.calendar.removeAllEvents();
                this.calendar.addEventSource(filteredEvents);
                
                // í†µê³„ ì—…ë°ì´íŠ¸
                this.updateEventStats(filteredEvents);
                
                console.log(`ğŸ¯ í•„í„°ë§ëœ ì´ë²¤íŠ¸: ${filteredEvents.length}ê°œ í‘œì‹œ`);
              } else {
                console.error("ì´ë²¤íŠ¸ ë¡œë“œ ì‹¤íŒ¨:", response.status);
                // ê¸°ë³¸ ì´ë²¤íŠ¸ ë¡œë“œ ì‹œë„
                await this.loadBasicEvents();
              }
            } catch (error) {
              console.error("ì´ë²¤íŠ¸ ë¡œë“œ ì‹¤íŒ¨:", error);
              // ê¸°ë³¸ ì´ë²¤íŠ¸ ë¡œë“œ ì‹œë„
              await this.loadBasicEvents();
            }
          },

          async loadBasicEvents() {
            // ê¸°ë³¸ ì´ë²¤íŠ¸ ë¡œë“œ (fallback)
            try {
              const response = await fetch('/calendar_events.json');
              if (response.ok) {
                const events = await response.json();
                
                const filteredEvents = events.filter(event => {
                  const eventType = event.extendedProps?.eventType;
                  return this.selectedEventTypes.includes(eventType);
                });

                this.calendar.removeAllEvents();
                this.calendar.addEventSource(filteredEvents);
                this.updateEventStats(filteredEvents);
                
                console.log(`ğŸ“… ê¸°ë³¸ ì´ë²¤íŠ¸ ë¡œë”©: ${filteredEvents.length}ê°œ`);
              }
            } catch (error) {
              console.error("ê¸°ë³¸ ì´ë²¤íŠ¸ ë¡œë“œë„ ì‹¤íŒ¨:", error);
            }
          },

          async loadMarketData() {
            try {
              // Load market indices (ìƒˆë¡œìš´ API ì‚¬ìš©)
              const indicesResponse = await fetch("/api/v1/stocks/market-indices");
              if (indicesResponse.ok) {
                const result = await indicesResponse.json();
                if (result.success && result.indices) {
                  // KOSPI ì§€ìˆ˜
                  if (result.indices.KOSPI) {
                    this.marketIndices.kospi = {
                      current_value: parseFloat(result.indices.KOSPI.current_value) || 0,
                      change_rate: parseFloat(result.indices.KOSPI.change_rate) || 0,
                      change_value: parseFloat(result.indices.KOSPI.change_value) || 0
                    };
                  }
                  
                  // KOSDAQ ì§€ìˆ˜
                  if (result.indices.KOSDAQ) {
                    this.marketIndices.kosdaq = {
                      current_value: parseFloat(result.indices.KOSDAQ.current_value) || 0,
                      change_rate: parseFloat(result.indices.KOSDAQ.change_rate) || 0,
                      change_value: parseFloat(result.indices.KOSDAQ.change_value) || 0
                    };
                  }
                  
                  console.log("ì‹œì¥ ì§€ìˆ˜ ì—…ë°ì´íŠ¸ë¨:", this.marketIndices);
                }
              } else {
                console.warn("ì‹œì¥ ì§€ìˆ˜ API ì‘ë‹µ ì‹¤íŒ¨");
              }

              // Load top stocks (ìƒìœ„ ì¢…ëª©)
              const topStocksResponse = await fetch("/api/v1/stocks/top-stocks");
              if (topStocksResponse.ok) {
                this.topStocks = await topStocksResponse.json();
                console.log("ìƒìœ„ ì¢…ëª© ë¡œë”©ë¨:", this.topStocks.length + "ê°œ");
              }

              // Load program trades
              const tradesResponse = await fetch("/api/v1/stocks/program-trade");
              if (tradesResponse.ok) {
                this.programTrades = await tradesResponse.json();
              }
              
            } catch (error) {
              console.error("ì‹œì¥ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
              // ê¸°ë³¸ê°’ ì„¤ì •
              this.marketIndices.kospi = { current_value: 0, change_rate: 0, change_value: 0 };
              this.marketIndices.kosdaq = { current_value: 0, change_rate: 0, change_value: 0 };
            }
          },

          async searchStocks() {
            if (this.searchQuery.length < 2) {
              this.searchResults = [];
              return;
            }

            try {
              const response = await fetch(
                `/api/v1/stocks/search?keyword=${encodeURIComponent(
                  this.searchQuery
                )}`
              );
              if (response.ok) {
                this.searchResults = await response.json();
              }
            } catch (error) {
              console.error("ì¢…ëª© ê²€ìƒ‰ ì‹¤íŒ¨:", error);
            }
          },

          updateEventStats(events) {
            // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ì´ë²¤íŠ¸ í†µê³„ ê³„ì‚°
            const today = new Date().toISOString().split('T')[0];
            const todayEvents = events.filter(event => event.start === today);
            
            // ì´ë²¤íŠ¸ íƒ€ì…ë³„ ê°œìˆ˜ ê³„ì‚°
            this.todayStats.earnings = todayEvents.filter(e => e.extendedProps?.eventType === 'earnings').length;
            this.todayStats.dividend = todayEvents.filter(e => e.extendedProps?.eventType === 'dividend').length;
            this.todayStats.economic = todayEvents.filter(e => e.extendedProps?.eventType === 'economic').length;
            this.todayStats.ipo = todayEvents.filter(e => e.extendedProps?.eventType === 'ipo').length;
            this.todayStats.holiday = todayEvents.filter(e => e.extendedProps?.eventType === 'holiday').length;
            
            // ë‹¤ê°€ì˜¤ëŠ” ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸ (ë‹¤ìŒ 7ì¼)
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            const nextWeekStr = nextWeek.toISOString().split('T')[0];
            
            this.upcomingEvents = events
              .filter(event => event.start > today && event.start <= nextWeekStr)
              .sort((a, b) => new Date(a.start) - new Date(b.start))
              .slice(0, 5);
            
            console.log(`ì˜¤ëŠ˜ì˜ ì´ë²¤íŠ¸ - ì‹¤ì ë°œí‘œ: ${this.todayStats.earnings}, ë°°ë‹¹: ${this.todayStats.dividend}, ê²½ì œì§€í‘œ: ${this.todayStats.economic}`);
          },

          formatEventDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('ko-KR', {
              month: 'long',
              day: 'numeric',
              weekday: 'short'
            });
          },

          selectUpcomingEvent(event) {
            // ë‹¤ê°€ì˜¤ëŠ” ì´ë²¤íŠ¸ í´ë¦­ ì‹œ ìº˜ë¦°ë”ë¡œ ì´ë™í•˜ê³  ì´ë²¤íŠ¸ ì„ íƒ
            this.activeTab = 'calendar';
            this.selectedEvent = {
              id: event.id,
              title: event.title,
              date: this.formatEventDate(event.start),
              description: event.extendedProps?.description || '',
              stockCode: event.extendedProps?.stockCode,
              stockName: event.extendedProps?.stockName,
              eventType: event.extendedProps?.eventType,
              importance: event.extendedProps?.importance,
              details: event.extendedProps?.details,
              time: event.extendedProps?.time,
              location: event.extendedProps?.location,
              currentPrice: event.extendedProps?.currentPrice,
              isBookmarked: event.extendedProps?.isBookmarked,
            };
            this.showEventModal = true;
          },

          async loadGlobalData() {
            try {
              const response = await fetch("/api/v1/stocks/global-markets");
              if (response.ok) {
                this.globalData = await response.json();
                this.lastGlobalUpdate = new Date().toLocaleTimeString('ko-KR');
                console.log('ê¸€ë¡œë²Œ ë°ì´í„° ì—…ë°ì´íŠ¸:', this.globalData);
              } else {
                console.error("ê¸€ë¡œë²Œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", response.status);
              }
            } catch (error) {
              console.error("ê¸€ë¡œë²Œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
            }
          },

          selectStock(stock) {
            this.searchQuery = "";
            this.searchResults = [];
            // Navigate to stock detail or add to watchlist
            if (this.activeTab === "watchlist") {
              this.addToWatchlist(stock);
            } else {
              // Show stock detail
              this.showStockDetail(stock);
            }
          },

          async showStockDetail(stock) {
            // Load stock price and show in modal or chart
            try {
              const response = await fetch(
                `/api/v1/stocks/price/${stock.stock_code}`
              );
              if (response.ok) {
                const priceData = await response.json();
                // Update UI with price data
                console.log(priceData);
              }
            } catch (error) {
              console.error("ì£¼ê°€ ì¡°íšŒ ì‹¤íŒ¨:", error);
            }
          },

          async checkAuth() {
            const token = localStorage.getItem("access_token");
            if (token) {
              try {
                const response = await fetch("/api/v1/users/me", {
                  headers: {
                    Authorization: `Bearer ${token}`,
                  },
                });
                if (response.ok) {
                  this.user = await response.json();
                  this.loadWatchlist();
                } else {
                  localStorage.removeItem("access_token");
                }
              } catch (error) {
                console.error("ì¸ì¦ í™•ì¸ ì‹¤íŒ¨:", error);
              }
            }
          },

          async login() {
            this.isLoading = true;
            try {
              const formData = new URLSearchParams();
              formData.append("username", this.loginForm.username);
              formData.append("password", this.loginForm.password);

              const response = await fetch("/api/v1/auth/login", {
                method: "POST",
                headers: {
                  "Content-Type": "application/x-www-form-urlencoded",
                },
                body: formData,
              });

              if (response.ok) {
                const data = await response.json();
                localStorage.setItem("access_token", data.access_token);
                await this.checkAuth();
                this.showLoginModal = false;
                this.loginForm = { username: "", password: "" };
                this.loadEvents();
                this.loadWatchlist();
              } else {
                const error = await response.json();
                alert(error.detail || "ë¡œê·¸ì¸ ì‹¤íŒ¨");
              }
            } catch (error) {
              console.error("ë¡œê·¸ì¸ ì˜¤ë¥˜:", error);
              alert("ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            } finally {
              this.isLoading = false;
            }
          },

          async signup() {
            this.isLoading = true;
            try {
              const response = await fetch("/api/v1/auth/signup", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(this.signupForm),
              });

              if (response.ok) {
                alert("íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
                this.showSignupModal = false;
                this.showLoginModal = true;
                this.signupForm = {
                  email: "",
                  username: "",
                  full_name: "",
                  password: "",
                };
              } else {
                const error = await response.json();
                alert(error.detail || "íšŒì›ê°€ì… ì‹¤íŒ¨");
              }
            } catch (error) {
              console.error("íšŒì›ê°€ì… ì˜¤ë¥˜:", error);
              alert("íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            } finally {
              this.isLoading = false;
            }
          },

          logout() {
            localStorage.removeItem("access_token");
            this.user = null;
            this.watchlist = [];
            this.loadEvents();
          },

          async loadWatchlist() {
            if (!this.user) return;

            try {
              const response = await fetch("/api/v1/watchlist", {
                headers: this.getAuthHeaders(),
              });
              if (response.ok) {
                this.watchlist = await response.json();
              }
            } catch (error) {
              console.error("ê´€ì‹¬ì¢…ëª© ë¡œë“œ ì‹¤íŒ¨:", error);
            }
          },

          async addToWatchlist(stock) {
            if (!this.user) {
              this.showLoginModal = true;
              return;
            }

            try {
              const response = await fetch("/api/v1/watchlist", {
                method: "POST",
                headers: {
                  ...this.getAuthHeaders(),
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  stock_code: stock.stock_code,
                  stock_name: stock.stock_name,
                }),
              });

              if (response.ok) {
                await this.loadWatchlist();
                alert("ê´€ì‹¬ì¢…ëª©ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
              } else {
                const error = await response.json();
                alert(error.detail || "ê´€ì‹¬ì¢…ëª© ì¶”ê°€ ì‹¤íŒ¨");
              }
            } catch (error) {
              console.error("ê´€ì‹¬ì¢…ëª© ì¶”ê°€ ì‹¤íŒ¨:", error);
            }
          },

          async removeFromWatchlist(itemId) {
            if (confirm("ê´€ì‹¬ì¢…ëª©ì—ì„œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
              try {
                const response = await fetch(`/api/v1/watchlist/${itemId}`, {
                  method: "DELETE",
                  headers: this.getAuthHeaders(),
                });

                if (response.ok) {
                  await this.loadWatchlist();
                }
              } catch (error) {
                console.error("ê´€ì‹¬ì¢…ëª© ì‚­ì œ ì‹¤íŒ¨:", error);
              }
            }
          },

          async toggleBookmark(event) {
            if (!this.user) {
              this.showLoginModal = true;
              return;
            }

            try {
              if (event.isBookmarked) {
                // Remove bookmark
                // Need to implement bookmark removal
              } else {
                // Add bookmark
                const response = await fetch("/api/v1/bookmarks", {
                  method: "POST",
                  headers: {
                    ...this.getAuthHeaders(),
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({
                    event_id: event.id,
                  }),
                });

                if (response.ok) {
                  event.isBookmarked = true;
                  this.loadEvents();
                }
              }
            } catch (error) {
              console.error("ë¶ë§ˆí¬ í† ê¸€ ì‹¤íŒ¨:", error);
            }
          },

          async loadDailyMarketSummary() {
            try {
              const response = await fetch("/api/v1/stocks/daily-market-summary");
              if (response.ok) {
                this.dailyMarketSummary = await response.json();
              } else {
                console.error("ì‹œì¥ ìš”ì•½ ë¡œë“œ ì‹¤íŒ¨:", response.status);
              }
            } catch (error) {
              console.error("ì‹œì¥ ìš”ì•½ ë¡œë“œ ì‹¤íŒ¨:", error);
            }
          },

          async explainEvent(event) {
            if (!event) return;
            
            // AI ë¡œë”© ëª¨ë‹¬ ë¨¼ì € í‘œì‹œ
            this.aiExplanation = null;
            this.showAiExplanationModal = true;
            this.isAiLoading = true;
            
            try {
              const response = await fetch("/api/v1/stocks/ai-explain/event", {
                method: "POST",
                headers: {
                  "Content-Type": "application/x-www-form-urlencoded",
                },
                body: new URLSearchParams({
                  event_title: event.title || "",
                  event_details: event.details || ""
                })
              });
              
              if (response.ok) {
                this.aiExplanation = await response.json();
              } else {
                this.aiExplanation = {
                  content: "ì£„ì†¡í•©ë‹ˆë‹¤. í˜„ì¬ AI ì„œë¹„ìŠ¤ì— ì¼ì‹œì ì¸ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
                  source: "ì‹œìŠ¤í…œ ë©”ì‹œì§€"
                };
              }
            } catch (error) {
              console.error("AI ì„¤ëª… ì‹¤íŒ¨:", error);
              this.aiExplanation = {
                content: "ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì— ë¬¸ì œê°€ ìˆì–´ AI ì„¤ëª…ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
                source: "ì‹œìŠ¤í…œ ë©”ì‹œì§€"
              };
            } finally {
              this.isAiLoading = false;
            }
          },

          async explainStock(event) {
            if (!event || !event.stockCode) return;
            
            // AI ë¡œë”© ëª¨ë‹¬ ë¨¼ì € í‘œì‹œ
            this.aiExplanation = null;
            this.showAiExplanationModal = true;
            this.isAiLoading = true;
            
            try {
              const response = await fetch(`/api/v1/stocks/ai-explain/stock/${event.stockCode}?stock_name=${encodeURIComponent(event.stockName || '')}&current_price=${encodeURIComponent(event.currentPrice || '0')}`);
              
              if (response.ok) {
                this.aiExplanation = await response.json();
              } else {
                this.aiExplanation = {
                  content: "ì£„ì†¡í•©ë‹ˆë‹¤. í•´ë‹¹ ì¢…ëª©ì— ëŒ€í•œ AI ë¶„ì„ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
                  source: "ì‹œìŠ¤í…œ ë©”ì‹œì§€"
                };
              }
            } catch (error) {
              console.error("AI ë¶„ì„ ì‹¤íŒ¨:", error);
              this.aiExplanation = {
                content: "ì¢…ëª© ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
                source: "ì‹œìŠ¤í…œ ë©”ì‹œì§€"
              };
            } finally {
              this.isAiLoading = false;
            }
          },

          async explainTerm(term, context = "") {
            // AI ë¡œë”© ëª¨ë‹¬ ë¨¼ì € í‘œì‹œ
            this.aiExplanation = null;
            this.showAiExplanationModal = true;
            this.isAiLoading = true;
            
            try {
              const response = await fetch("/api/v1/stocks/ai-explain/term", {
                method: "POST",
                headers: {
                  "Content-Type": "application/x-www-form-urlencoded",
                },
                body: new URLSearchParams({
                  term: term,
                  context: context
                })
              });
              
              if (response.ok) {
                this.aiExplanation = await response.json();
              } else {
                this.aiExplanation = {
                  content: `"${term}"ì— ëŒ€í•œ AI ì„¤ëª…ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`,
                  source: "ì‹œìŠ¤í…œ ë©”ì‹œì§€"
                };
              }
            } catch (error) {
              console.error("AI ì„¤ëª… ì‹¤íŒ¨:", error);
              this.aiExplanation = {
                content: "ìš©ì–´ ì„¤ëª… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
                source: "ì‹œìŠ¤í…œ ë©”ì‹œì§€"
              };
            } finally {
              this.isAiLoading = false;
            }
          },

          async explainCrypto(crypto) {
            // AI ë¡œë”© ëª¨ë‹¬ ë¨¼ì € í‘œì‹œ
            this.aiExplanation = null;
            this.showAiExplanationModal = true;
            this.isAiLoading = true;
            
            try {
              const response = await fetch("/api/v1/stocks/ai-explain/term", {
                method: "POST",
                headers: {
                  "Content-Type": "application/x-www-form-urlencoded",
                },
                body: new URLSearchParams({
                  term: `${crypto.symbol} ê°€ìƒí™”í`,
                  context: `í˜„ì¬ê°€: ${crypto.price.toLocaleString()}ì›, ë³€ë™ë¥ : ${crypto.change_rate.toFixed(2)}%`
                })
              });
              
              if (response.ok) {
                this.aiExplanation = await response.json();
              } else {
                this.aiExplanation = {
                  content: `${crypto.symbol} ê°€ìƒí™”íì— ëŒ€í•œ AI ì„¤ëª…ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`,
                  source: "ì‹œìŠ¤í…œ ë©”ì‹œì§€"
                };
              }
            } catch (error) {
              console.error("ê°€ìƒí™”í ì„¤ëª… ì‹¤íŒ¨:", error);
              this.aiExplanation = {
                content: "ê°€ìƒí™”í ì„¤ëª… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
                source: "ì‹œìŠ¤í…œ ë©”ì‹œì§€"
              };
            } finally {
              this.isAiLoading = false;
            }
          },

          // ==================== DART ê³µì‹œì •ë³´ í•¨ìˆ˜ë“¤ ====================

          async loadRecentDisclosures() {
            this.disclosureLoading = true;
            try {
              const response = await fetch(
                `/api/v1/stocks/recent-disclosures?corp_cls=${this.disclosureSearch.corpCls}&days=${this.disclosureSearch.days}&important_only=true`
              );
              
              if (response.ok) {
                const result = await response.json();
                this.disclosures = result.data || [];
                this.lastDisclosureUpdate = new Date().toLocaleTimeString();
              } else {
                console.error("ê³µì‹œì •ë³´ ë¡œë”© ì‹¤íŒ¨:", response.status);
              }
            } catch (error) {
              console.error("ê³µì‹œì •ë³´ ë¡œë”© ì˜¤ë¥˜:", error);
            } finally {
              this.disclosureLoading = false;
            }
          },

          async searchDisclosures() {
            if (!this.disclosureSearch.companyName.trim() && this.disclosureSearch.corpCls === '') {
              // íšŒì‚¬ëª…ì´ ì—†ìœ¼ë©´ ìµœê·¼ ê³µì‹œ ë¡œë”©
              await this.loadRecentDisclosures();
              return;
            }

            this.disclosureLoading = true;
            try {
              let url = `/api/v1/stocks/disclosures?days=${this.disclosureSearch.days}&page_count=20`;
              
              if (this.disclosureSearch.corpCls) {
                url += `&corp_cls=${this.disclosureSearch.corpCls}`;
              }

              const response = await fetch(url);
              
              if (response.ok) {
                const result = await response.json();
                if (result.success) {
                  let disclosures = result.data || [];
                  
                  // íšŒì‚¬ëª…ìœ¼ë¡œ í•„í„°ë§
                  if (this.disclosureSearch.companyName.trim()) {
                    const searchTerm = this.disclosureSearch.companyName.trim().toLowerCase();
                    disclosures = disclosures.filter(d => 
                      d.corp_name.toLowerCase().includes(searchTerm)
                    );
                  }
                  
                  this.disclosures = disclosures;
                  this.lastDisclosureUpdate = new Date().toLocaleTimeString();
                } else {
                  alert(result.error || "ê³µì‹œì •ë³´ ê²€ìƒ‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                }
              } else {
                alert("ê³µì‹œì •ë³´ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
              }
            } catch (error) {
              console.error("ê³µì‹œì •ë³´ ê²€ìƒ‰ ì˜¤ë¥˜:", error);
              alert("ê³µì‹œì •ë³´ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            } finally {
              this.disclosureLoading = false;
            }
          },

          async viewDisclosureDetail(disclosure) {
            try {
              const response = await fetch(`/api/v1/stocks/disclosure/${disclosure.rcept_no}`);
              
              if (response.ok) {
                const result = await response.json();
                if (result.success && result.dart_viewer_url) {
                  // DART ë·°ì–´ì—ì„œ ê³µì‹œ ìƒì„¸ ë‚´ìš© ë³´ê¸°
                  window.open(result.dart_viewer_url, '_blank');
                } else {
                  alert("ê³µì‹œ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                }
              } else {
                alert("ê³µì‹œ ìƒì„¸ ì •ë³´ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
              }
            } catch (error) {
              console.error("ê³µì‹œ ìƒì„¸ ì¡°íšŒ ì˜¤ë¥˜:", error);
              alert("ê³µì‹œ ìƒì„¸ ì •ë³´ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
          },

          async explainDisclosure(disclosure) {
            // AI ë¡œë”© ëª¨ë‹¬ ë¨¼ì € í‘œì‹œ
            this.aiExplanation = null;
            this.showAiExplanationModal = true;
            this.isAiLoading = true;
            
            try {
              const response = await fetch("/api/v1/stocks/ai-explain/event", {
                method: "POST",
                headers: {
                  "Content-Type": "application/x-www-form-urlencoded",
                },
                body: new URLSearchParams({
                  event_title: disclosure.report_nm,
                  event_details: `íšŒì‚¬ëª…: ${disclosure.corp_name}, ì ‘ìˆ˜ì¼: ${disclosure.rcept_dt}, ì œì¶œì¸: ${disclosure.flr_nm}`
                })
              });
              
              if (response.ok) {
                this.aiExplanation = await response.json();
              } else {
                this.aiExplanation = {
                  content: `${disclosure.corp_name}ì˜ "${disclosure.report_nm}" ê³µì‹œì— ëŒ€í•œ AI ì„¤ëª…ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`,
                  source: "ì‹œìŠ¤í…œ ë©”ì‹œì§€"
                };
              }
            } catch (error) {
              console.error("ê³µì‹œ ì„¤ëª… ì‹¤íŒ¨:", error);
              this.aiExplanation = {
                content: "ê³µì‹œ ì„¤ëª… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
                source: "ì‹œìŠ¤í…œ ë©”ì‹œì§€"
              };
            } finally {
              this.isAiLoading = false;
            }
          },

          getAuthHeaders() {
            const token = localStorage.getItem("access_token");
            return token ? { Authorization: `Bearer ${token}` } : {};
          },
        };
      }
    </script>
  </body>
</html>
